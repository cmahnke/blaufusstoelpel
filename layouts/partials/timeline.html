<section>
  <div class="container timeline mb-5">
    <div class="row">
      <div class="col-lg-12 py-3">
        <article class="content-clean">
          {{.Content}}
        </article>

            {{/* See https://getbootstrap.com/docs/4.0/components/navs/ */}}
            <ul class="nav nav-tabs justify-content-center" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="horizontal-tab" data-toggle="tab" href="#timeline" role="tab" aria-controls="timeline">Horizontal</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="vertical-tab" data-toggle="tab" href="#vertical" role="tab" aria-controls="vertical">Vertikal</a>
              </li>
            </ul>

            {{- $issues := where .Site.Pages "Params.issueyear" "!=" nil -}}
            {{- $issues = sort $issues ".Params.issueyear" -}}
            <div class="tab-content">
                <div id="timeline" class="tab-pane fade show active timeline" role="tabpanel" aria-labelledby="horizontal-tab"></div>

                <div id="vertical" class="tab-pane fade timeline-vertical" role="tabpanel" aria-labelledby="vertical-tab">
                    {{- $first := index (first 1 $issues) 0 -}}
                    {{- $last := index (last 1 $issues) 0 -}}

                    {{- range $index, $entry := $issues -}}
                        {{- $year := .Params.issueYear -}}
                        {{- $month := 1 -}}
                        {{- if isset .Params "issueMonth" -}}
                            {{- $month = .Params.issueMonth -}}
                        {{- end -}}

                        {{- $context := path.Dir .File.Path -}}
                        {{- $images := newScratch -}}
                        {{- $entry := . -}}

                        {{- range .Params.resources -}}
                            {{- if eq ($images.Get "preview") nil -}}
                                {{- if or (eq .name "front") (eq .name "cover") -}}
                                    {{- $images.Set "previewLoc" (path.Join $context .src) -}}
                                    {{- $images.Set "preview" (($entry.Resources.ByType "image").GetMatch .name) -}}
                                {{- end -}}
                            {{- end -}}
                        {{- end -}}

                        {{- $imgLocation := $images.Get "previewLoc" -}}
                        {{- $previewImg := $images.Get "preview" -}}
                        {{- if eq $previewImg nil -}}
                            {{- warnf "Can't find image %s for post %s" $imgLocation $context -}}
                        {{- end -}}
                        {{- $previewImg = $previewImg.Resize "370x"  -}}

                        {{- $class := "" -}}
                        {{- if eq (mod $index 2) 0 -}}
                            {{- $class = "even" -}}
                        {{- else -}}
                            {{- $class = "odd" -}}
                        {{- end -}}

                        <div class="timeline-item {{ $class }}">
                            <div class="preview-img-container">
                                <a href="{{ .RelPermalink }}">
                                    <img class="list img-fluid mb-4 preview-img" src="{{ $previewImg.RelPermalink }}" alt="Cover">
                                    <div class="year">{{- $year -}}</div>
                                </a>
                            </div>
                            <div class="preview-text-container">
                                <a href="{{ .RelPermalink }}">

                                    {{- $title := "" -}}
                                    {{ if isset .Params "subtitle" -}}
                                      {{- $title = printf "%s: %s" .Title .Params.subTitle -}}
                                    {{- else -}}
                                      {{- $title = .Title -}}
                                    {{- end -}}
                                    <div class="preview-title">{{ $title }}</div>
                                    <p>{{ .Summary }}</p>
                                </a>
{{/*
            (, {{- $month -}}, 1), "url": {{ .RelPermalink | jsonify }}},
        */}}
                            </div>
                        </div>
                    {{- end -}}

                </div>
            </div>
            <script type="text/javascript">

                if ($(window).width() < 1024) {
                    $('#vertical-tab').tab('show')
                }

                var issues = [
                    {{- range $issues -}}
                            {{- $year := .Params.issueYear -}}
                            {{- $month := 1 -}}
                            {{- if isset .Params "issueMonth" -}}
                                {{- $month = .Params.issueMonth -}}
                            {{- end -}}
                            {{- $content := printf "<a href=\"%s\">%s</a>" .RelPermalink .Title -}}
                            {"content": "{{ $content }}", "start": new Date({{- $year -}}, {{- $month -}}, 1), "url": {{ .RelPermalink | jsonify }}},

                    {{- end -}}
                ];
                var options = {};
                var timeline = addTimeline('timeline', issues, options);
            </script>
      </div>
    </div>
  </div>
</section>
