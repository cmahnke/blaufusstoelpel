{{- $context := . -}}
{{- $contextPath := path.Dir .File.Path -}}
{{- $images := newScratch -}}
{{- $entry := . -}}
{{- $name := "front" -}}

{{- $previewImg := partial "preview/preview-internal.html" (dict "context" $context) -}}

{{/*
{{- range .Params.resources -}}
    {{- if eq .name $name -}}
        {{- $images.Set "previewLoc" (path.Join $contextPath .src) -}}
        {{- $images.Set "preview" (($entry.Resources.ByType "image").GetMatch .name) -}}
    {{ end }}
{{ end }}

{{- $imgLocation := $images.Get "previewLoc" -}}
{{- $previewImg := $images.Get "preview" -}}

{{- if eq (string $previewImg.MediaType) "image/jxl" -}}
  {{- if not $name -}}
    {{- warnf "[partials/preview-image.html] JXL Reference in %s, but no 'name' set, using default" $context.File.Path -}}
  {{- end -}}
  {{- $previewImg = partial "iiif/preview.html" (dict "context" $context "name" $name) -}}
{{- end -}}

{{- if eq $previewImg nil -}}
    {{- warnf "[partials/preview-image.html] Can't find image %s for post %s" $imgLocation $contextPath -}}
{{- end -}}
*/}}

{{- return $previewImg -}}
