{{- $page := . -}}
{{- $context := path.Dir .File.Path -}}
{{- $images := newScratch -}}
{{- $entry := . -}}
{{- $name := "front" -}}

{{- range .Params.resources -}}
    {{- if eq .name $name -}}
        {{- $images.Set "previewLoc" (path.Join $context .src) -}}
        {{- $images.Set "preview" (($entry.Resources.ByType "image").GetMatch .name) -}}
    {{ end }}
{{ end }}

{{- $imgLocation := $images.Get "previewLoc" -}}
{{- $previewImg := $images.Get "preview" -}}

{{- if eq (string $previewImg.MediaType) "image/jxl" -}}
  {{/* {{- warnf "[partials/preview-image.html] Page %s contains JXL image in 'iiif/iiif-image.html'" $page.File.Path -}} */}}
  {{- if not $name -}}
    {{- warnf "[partials/preview-image.html] JXL Reference in %s, but no 'name' set, using default" $page.File.Path -}}
  {{- end -}}
  {{- $previewImg = partial "iiif/preview.html" (dict "context" $page "name" $name) -}}
{{- end -}}

{{- if eq $previewImg nil -}}
    {{- warnf "[partials/preview-image.html] Can't find image %s for post %s" $imgLocation $context -}}
{{- end -}}
{{- return $previewImg -}}
